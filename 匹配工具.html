<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人岗匹配分析工具</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- SheetJS for Excel handling -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a56db',
                        secondary: '#e2e8f0',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        neutral: '#64748b',
                        'neutral-light': '#f1f5f9',
                        'neutral-dark': '#334155'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        card: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .transition-height {
                transition: height 0.3s ease;
            }
            .scrollbar-thin {
                scrollbar-width: thin;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .scrollbar-thin::-webkit-scrollbar-track {
                background: #f1f5f9;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background-color: #cbd5e1;
                border-radius: 3px;
            }
            .text-shadow {
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            }
            .bg-gradient-blue {
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
    <!-- Header -->
    <header class="bg-gradient-blue text-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fa fa-users-cog text-2xl"></i>
                <h1 class="text-xl font-bold text-shadow">人岗匹配分析工具</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="helpBtn" class="px-3 py-1 rounded-md bg-white/20 hover:bg-white/30 transition-colors flex items-center">
                    <i class="fa fa-question-circle mr-2"></i>
                    <span class="hidden sm:inline">帮助</span>
                </button>
                <button id="settingsBtn" class="px-3 py-1 rounded-md bg-white/20 hover:bg-white/30 transition-colors flex items-center">
                    <i class="fa fa-cog mr-2"></i>
                    <span class="hidden sm:inline">设置</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Tabs for Mobile View -->
        <div class="md:hidden mb-4">
            <div class="flex border-b border-gray-200">
                <button id="inputTab" class="flex-1 py-3 text-center font-medium text-primary border-b-2 border-primary">
                    <i class="fa fa-edit mr-1"></i> 输入信息
                </button>
                <button id="configTab" class="flex-1 py-3 text-center font-medium text-gray-500 hover:text-primary">
                    <i class="fa fa-sliders mr-1"></i> 分析配置
                </button>
                <button id="resultTab" class="flex-1 py-3 text-center font-medium text-gray-500 hover:text-primary">
                    <i class="fa fa-bar-chart mr-1"></i> 分析结果
                </button>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-6">
            <!-- Left Panel: Input Area -->
            <div id="inputPanel" class="w-full md:w-1/2 space-y-6">
                <!-- Single Input Section -->
                <div class="bg-white rounded-lg shadow-card p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-file-text-o text-primary mr-2"></i>
                        单条输入
                    </h2>
                    
                    <div class="space-y-4">
                        <!-- Resume Input -->
                        <div>
                            <label for="resumeInput" class="block text-sm font-medium text-gray-700 mb-1">
                                人才简历
                            </label>
                            <textarea 
                                id="resumeInput" 
                                rows="6" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none scrollbar-thin"
                                placeholder="请输入或粘贴人才简历内容，包括教育背景、工作经验、技能等信息..."
                            ></textarea>
                        </div>
                        
                        <!-- Job Description Input -->
                        <div>
                            <label for="jobInput" class="block text-sm font-medium text-gray-700 mb-1">
                                岗位要求/JD
                            </label>
                            <textarea 
                                id="jobInput" 
                                rows="6" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none scrollbar-thin"
                                placeholder="请输入或粘贴岗位描述内容，包括职责要求、任职资格等信息..."
                            ></textarea>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="addSingleBtn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center">
                                <i class="fa fa-plus-circle mr-2"></i>
                                添加到分析列表
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Batch Upload Section -->
                <div class="bg-white rounded-lg shadow-card p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-upload text-primary mr-2"></i>
                        批量上传
                    </h2>
                    
                    <div class="space-y-4">
                        <!-- Excel Upload Area -->
                        <div 
                            id="excelUploadArea" 
                            class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center cursor-pointer hover:border-primary transition-colors"
                        >
                            <i class="fa fa-file-excel-o text-4xl text-gray-400 mb-2"></i>
                            <p class="text-sm text-gray-600 mb-1">拖拽Excel文件到此处，或点击上传</p>
                            <p class="text-xs text-gray-500">支持 .xlsx 格式</p>
                            <input 
                                type="file" 
                                id="excelFileInput" 
                                accept=".xlsx" 
                                class="hidden"
                            >
                        </div>
                        
                        <!-- Excel Format Template -->
                        <div class="text-center">
                            <p class="text-xs text-gray-500 mb-2">Excel格式要求：岗位 | 简历 | 是否匹配 | 匹配分数 | 分析原因</p>
                            <button id="downloadTemplateBtn" class="text-primary hover:text-primary/80 text-sm flex items-center mx-auto">
                                <i class="fa fa-download mr-1"></i>
                                下载模板
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Analysis List -->
                <div class="bg-white rounded-lg shadow-card p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-list-ul text-primary mr-2"></i>
                        分析列表
                        <span id="analysisCount" class="ml-2 px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full">0</span>
                    </h2>
                    
                    <div class="overflow-auto max-h-60 scrollbar-thin">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">岗位</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">简历</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="analysisList" class="bg-white divide-y divide-gray-200">
                                <!-- Analysis items will be added here dynamically -->
                                <tr class="text-gray-500 text-center">
                                    <td colspan="4" class="px-3 py-4">暂无数据，请添加或上传</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Configuration and Results -->
            <div id="configPanel" class="w-full md:w-1/2 space-y-6">
                <!-- Model Selection Section -->
                <div class="bg-white rounded-lg shadow-card p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-brain text-primary mr-2"></i>
                        模型选择
                    </h2>
                    
                    <div class="space-y-4">
                        <select 
                            id="modelSelect" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"
                        >
                            <option value="gpt4">GPT-4 (高精度分析)</option>
                            <option value="gpt35">GPT-3.5 Turbo (平衡型)</option>
                            <option value="gemini">Gemini Pro (多维度分析)</option>
                            <option value="claude">Claude 3 (详细分析)</option>
                            <option value="llama">Llama 3 (专业领域分析)</option>
                        </select>
                        
                        <div class="text-sm text-gray-500">
                            <p>选择适合您需求的AI模型进行人岗匹配分析。不同模型在分析深度、速度和侧重点上有所不同。</p>
                        </div>
                    </div>
                </div>
                
                <!-- Prompt Configuration Section -->
                <div class="bg-white rounded-lg shadow-card p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-terminal text-primary mr-2"></i>
                        分析指令配置
                    </h2>
                    
                    <div class="space-y-4">
                        <textarea 
                            id="promptInput" 
                            rows="6" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none scrollbar-thin"
                            placeholder="请输入自定义分析指令..."
                        >请对以下简历与岗位要求进行匹配分析，从技能匹配度、经验匹配度、教育背景匹配度等多个维度进行评估，给出总体匹配分数(0-100分)，并详细说明匹配或不匹配的原因。

简历: {resume}

岗位要求: {job}

分析结果应包含：
1. 总体匹配分数(0-100)
2. 是否匹配(是/否)
3. 技能匹配度评分及分析
4. 经验匹配度评分及分析
5. 教育背景匹配度评分及分析
6. 综合分析原因
7. 改进建议(如有)</textarea>
                        
                        <div class="flex justify-between">
                            <button id="resetPromptBtn" class="px-3 py-1.5 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors text-sm">
                                重置为默认
                            </button>
                            <button id="savePromptBtn" class="px-3 py-1.5 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors text-sm flex items-center">
                                <i class="fa fa-save mr-1"></i>
                                保存配置
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Analysis Control Section -->
                <div class="bg-white rounded-lg shadow-card p-5">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-play-circle text-primary mr-2"></i>
                        分析控制
                    </h2>
                    
                    <div class="space-y-4">
                        <button 
                            id="startAnalysisBtn" 
                            class="w-full py-3 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors flex items-center justify-center text-lg font-medium disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled
                        >
                            <i class="fa fa-play mr-2"></i>
                            开始分析
                        </button>
                        
                        <!-- Progress Bar (Hidden by default) -->
                        <div id="progressContainer" class="hidden">
                            <div class="flex justify-between text-sm mb-1">
                                <span>分析进度</span>
                                <span id="progressText">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="progressBar" class="bg-primary h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="progressStatus" class="text-sm text-gray-600 mt-2 text-center">准备开始分析...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div id="resultsSection" class="bg-white rounded-lg shadow-card p-5 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold flex items-center">
                            <i class="fa fa-bar-chart text-primary mr-2"></i>
                            分析结果
                        </h2>
                        <button id="exportResultsBtn" class="px-3 py-1.5 bg-success text-white rounded-md hover:bg-success/90 transition-colors text-sm flex items-center">
                            <i class="fa fa-download mr-1"></i>
                            导出Excel
                        </button>
                    </div>
                    
                    <!-- Summary Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-neutral-light rounded-lg p-4 text-center">
                            <p class="text-neutral text-sm">总分析数</p>
                            <p id="totalAnalysis" class="text-2xl font-bold text-neutral-dark">0</p>
                        </div>
                        <div class="bg-success/10 rounded-lg p-4 text-center">
                            <p class="text-success text-sm">匹配数量</p>
                            <p id="matchCount" class="text-2xl font-bold text-success">0</p>
                        </div>
                        <div class="bg-primary/10 rounded-lg p-4 text-center">
                            <p class="text-primary text-sm">平均匹配度</p>
                            <p id="avgMatchScore" class="text-2xl font-bold text-primary">0%</p>
                        </div>
                    </div>
                    
                    <!-- Match Score Distribution Chart -->
                    <div class="mb-6">
                        <h3 class="text-md font-medium mb-3">匹配分数分布</h3>
                        <div class="h-64">
                            <canvas id="matchDistributionChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Detailed Results Table -->
                    <div>
                        <h3 class="text-md font-medium mb-3">详细结果</h3>
                        <div class="overflow-auto max-h-80 scrollbar-thin">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">岗位</th>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">匹配分数</th>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">是否匹配</th>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Results will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-sm">© 2025 人岗匹配分析工具 | 专业的AI招聘辅助平台</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-300 hover:text-white transition-colors">
                        <i class="fa fa-question-circle"></i> 常见问题
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition-colors">
                        <i class="fa fa-envelope"></i> 联系我们
                    </a>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Modal for Detailed Analysis -->
    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center border-b border-gray-200 px-6 py-4">
                <h3 class="text-lg font-semibold" id="detailModalTitle">详细分析报告</h3>
                <button id="closeDetailModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4 overflow-y-auto max-h-[calc(90vh-120px)] scrollbar-thin" id="detailModalContent">
                <!-- Detailed analysis content will be added here -->
            </div>
            <div class="border-t border-gray-200 px-6 py-4 flex justify-end">
                <button id="closeDetailBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors">
                    关闭
                </button>
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center border-b border-gray-200 px-6 py-4">
                <h3 class="text-lg font-semibold">使用帮助</h3>
                <button id="closeHelpModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4 overflow-y-auto max-h-[calc(90vh-120px)] scrollbar-thin">
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium text-primary">1. 输入信息</h4>
                        <p class="text-sm text-gray-600">您可以通过两种方式输入人才简历和岗位要求：</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-1 ml-2">
                            <li>单条输入：直接在文本框中输入或粘贴简历和岗位描述</li>
                            <li>批量上传：上传符合模板格式的Excel文件</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-primary">2. 分析配置</h4>
                        <p class="text-sm text-gray-600">选择适合您需求的AI模型，并可根据需要自定义分析指令。</p>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-primary">3. 开始分析</h4>
                        <p class="text-sm text-gray-600">点击"开始分析"按钮，系统将对所有添加的简历和岗位进行匹配分析。</p>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-primary">4. 查看结果</h4>
                        <p class="text-sm text-gray-600">分析完成后，您可以查看总体统计数据、匹配分数分布图表以及详细的分析结果。</p>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-primary">5. 导出结果</h4>
                        <p class="text-sm text-gray-600">点击"导出Excel"按钮，将分析结果导出为Excel文件。</p>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 px-6 py-4 flex justify-end">
                <button id="closeHelpBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors">
                    我知道了
                </button>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
            <div class="flex justify-between items-center border-b border-gray-200 px-6 py-4">
                <h3 class="text-lg font-semibold">设置</h3>
                <button id="closeSettingsModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4">
                <div class="space-y-4">
                    <div>
                        <label for="matchThreshold" class="block text-sm font-medium text-gray-700 mb-1">
                            匹配阈值 (0-100)
                        </label>
                        <div class="flex items-center space-x-3">
                            <input 
                                type="range" 
                                id="matchThreshold" 
                                min="0" 
                                max="100" 
                                value="70" 
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                            >
                            <span id="matchThresholdValue" class="text-sm font-medium text-gray-700 w-8 text-center">70</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">匹配分数高于此阈值将被标记为"匹配"</p>
                    </div>
                    
                    <div>
                        <label for="analysisSpeed" class="block text-sm font-medium text-gray-700 mb-1">
                            分析速度
                        </label>
                        <select 
                            id="analysisSpeed" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"
                        >
                            <option value="slow">慢速 (更详细的分析)</option>
                            <option value="medium" selected>中速 (平衡)</option>
                            <option value="fast">快速 (简要分析)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 px-6 py-4 flex justify-end">
                <button id="saveSettingsBtn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">
                    保存设置
                </button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        const analysisItems = [];
        const analysisResults = [];
        let currentAnalysisIndex = 0;
        let analysisSpeed = 1000; // 默认中速
        let matchThreshold = 70; // 默认匹配阈值
        let matchDistributionChart = null;
        
        // DOM 元素
        const resumeInput = document.getElementById('resumeInput');
        const jobInput = document.getElementById('jobInput');
        const addSingleBtn = document.getElementById('addSingleBtn');
        const excelUploadArea = document.getElementById('excelUploadArea');
        const excelFileInput = document.getElementById('excelFileInput');
        const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
        const analysisList = document.getElementById('analysisList');
        const analysisCount = document.getElementById('analysisCount');
        const modelSelect = document.getElementById('modelSelect');
        const promptInput = document.getElementById('promptInput');
        const resetPromptBtn = document.getElementById('resetPromptBtn');
        const savePromptBtn = document.getElementById('savePromptBtn');
        const startAnalysisBtn = document.getElementById('startAnalysisBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progressStatus = document.getElementById('progressStatus');
        const resultsSection = document.getElementById('resultsSection');
        const totalAnalysis = document.getElementById('totalAnalysis');
        const matchCount = document.getElementById('matchCount');
        const avgMatchScore = document.getElementById('avgMatchScore');
        const resultsTableBody = document.getElementById('resultsTableBody');
        const exportResultsBtn = document.getElementById('exportResultsBtn');
        const detailModal = document.getElementById('detailModal');
        const detailModalTitle = document.getElementById('detailModalTitle');
        const detailModalContent = document.getElementById('detailModalContent');
        const closeDetailModal = document.getElementById('closeDetailModal');
        const closeDetailBtn = document.getElementById('closeDetailBtn');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const closeHelpModal = document.getElementById('closeHelpModal');
        const closeHelpBtn = document.getElementById('closeHelpBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsModal = document.getElementById('closeSettingsModal');
        const matchThresholdInput = document.getElementById('matchThreshold');
        const matchThresholdValue = document.getElementById('matchThresholdValue');
        const analysisSpeedSelect = document.getElementById('analysisSpeed');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        
        // 移动端标签页
        const inputTab = document.getElementById('inputTab');
        const configTab = document.getElementById('configTab');
        const resultTab = document.getElementById('resultTab');
        const inputPanel = document.getElementById('inputPanel');
        const configPanel = document.getElementById('configPanel');
        
        // 默认 Prompt
        const defaultPrompt = `请对以下简历与岗位要求进行匹配分析，从技能匹配度、经验匹配度、教育背景匹配度等多个维度进行评估，给出总体匹配分数(0-100分)，并详细说明匹配或不匹配的原因。

简历: {resume}

岗位要求: {job}

分析结果应包含：
1. 总体匹配分数(0-100)
2. 是否匹配(是/否)
3. 技能匹配度评分及分析
4. 经验匹配度评分及分析
5. 教育背景匹配度评分及分析
6. 综合分析原因
7. 改进建议(如有)`;
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 加载保存的设置
            loadSettings();
            
            // 更新分析列表计数
            updateAnalysisCount();
            
            // 检查是否可以开始分析
            checkStartAnalysis();
            
            // 绑定事件
            bindEvents();
        });
        
        // 绑定事件
        function bindEvents() {
            // 添加单条分析
            addSingleBtn.addEventListener('click', addSingleAnalysis);
            
            // Excel 上传
            excelUploadArea.addEventListener('click', () => excelFileInput.click());
            excelUploadArea.addEventListener('dragover', handleDragOver);
            excelUploadArea.addEventListener('drop', handleDrop);
            excelFileInput.addEventListener('change', handleFileSelect);
            
            // 下载模板
            downloadTemplateBtn.addEventListener('click', downloadTemplate);
            
            // 重置 Prompt
            resetPromptBtn.addEventListener('click', resetPrompt);
            
            // 保存配置
            savePromptBtn.addEventListener('click', saveSettings);
            
            // 开始分析
            startAnalysisBtn.addEventListener('click', startAnalysis);
            
            // 导出结果
            exportResultsBtn.addEventListener('click', exportResults);
            
            // 详情模态框
            closeDetailModal.addEventListener('click', () => detailModal.classList.add('hidden'));
            closeDetailBtn.addEventListener('click', () => detailModal.classList.add('hidden'));
            
            // 帮助模态框
            helpBtn.addEventListener('click', () => helpModal.classList.remove('hidden'));
            closeHelpModal.addEventListener('click', () => helpModal.classList.add('hidden'));
            closeHelpBtn.addEventListener('click', () => helpModal.classList.add('hidden'));
            
            // 设置模态框
            settingsBtn.addEventListener('click', () => settingsModal.classList.remove('hidden'));
            closeSettingsModal.addEventListener('click', () => settingsModal.classList.add('hidden'));
            saveSettingsBtn.addEventListener('click', saveSettings);
            
            // 匹配阈值滑块
            matchThresholdInput.addEventListener('input', () => {
                matchThresholdValue.textContent = matchThresholdInput.value;
                matchThreshold = parseInt(matchThresholdInput.value);
            });
            
            // 移动端标签页切换
            inputTab.addEventListener('click', () => switchTab('input'));
            configTab.addEventListener('click', () => switchTab('config'));
            resultTab.addEventListener('click', () => switchTab('result'));
        }
        
        // 加载设置
        function loadSettings() {
            const savedSettings = JSON.parse(localStorage.getItem('personJobMatcherSettings') || '{}');
            
            // 模型选择
            if (savedSettings.model) {
                modelSelect.value = savedSettings.model;
            }
            
            // Prompt
            if (savedSettings.prompt) {
                promptInput.value = savedSettings.prompt;
            } else {
                promptInput.value = defaultPrompt;
            }
            
            // 匹配阈值
            if (savedSettings.matchThreshold !== undefined) {
                matchThreshold = savedSettings.matchThreshold;
                matchThresholdInput.value = matchThreshold;
                matchThresholdValue.textContent = matchThreshold;
            }
            
            // 分析速度
            if (savedSettings.analysisSpeed) {
                analysisSpeedSelect.value = savedSettings.analysisSpeed;
                updateAnalysisSpeed(savedSettings.analysisSpeed);
            }
        }
        
        // 保存设置
        function saveSettings() {
            const settings = {
                model: modelSelect.value,
                prompt: promptInput.value,
                matchThreshold: matchThreshold,
                analysisSpeed: analysisSpeedSelect.value
            };
            
            localStorage.setItem('personJobMatcherSettings', JSON.stringify(settings));
            
            // 更新分析速度
            updateAnalysisSpeed(analysisSpeedSelect.value);
            
            // 显示保存成功提示
            alert('设置已保存');
            
            // 关闭设置模态框
            settingsModal.classList.add('hidden');
        }
        
        // 更新分析速度
        function updateAnalysisSpeed(speed) {
            switch (speed) {
                case 'slow':
                    analysisSpeed = 2000;
                    break;
                case 'medium':
                    analysisSpeed = 1000;
                    break;
                case 'fast':
                    analysisSpeed = 500;
                    break;
                default:
                    analysisSpeed = 1000;
            }
        }
        
        // 重置 Prompt
        function resetPrompt() {
            promptInput.value = defaultPrompt;
        }
        
        // 添加单条分析
        function addSingleAnalysis() {
            const resume = resumeInput.value.trim();
            const job = jobInput.value.trim();
            
            if (!resume || !job) {
                alert('请输入简历和岗位要求');
                return;
            }
            
            // 创建分析项
            const item = {
                id: Date.now().toString(),
                job: job.substring(0, 50) + (job.length > 50 ? '...' : ''),
                fullJob: job,
                resume: resume.substring(0, 50) + (resume.length > 50 ? '...' : ''),
                fullResume: resume
            };
            
            // 添加到分析列表
            analysisItems.push(item);
            
            // 更新分析列表
            renderAnalysisList();
            
            // 更新分析计数
            updateAnalysisCount();
            
            // 检查是否可以开始分析
            checkStartAnalysis();
            
            // 清空输入框
            resumeInput.value = '';
            jobInput.value = '';
        }
        
        // 处理拖拽
        function handleDragOver(e) {
            e.preventDefault();
            excelUploadArea.classList.add('border-primary');
        }
        
        // 处理放置
        function handleDrop(e) {
            e.preventDefault();
            excelUploadArea.classList.remove('border-primary');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].name.endsWith('.xlsx')) {
                processExcelFile(files[0]);
            } else {
                alert('请上传 .xlsx 格式的Excel文件');
            }
        }
        
        // 处理文件选择
        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0 && files[0].name.endsWith('.xlsx')) {
                processExcelFile(files[0]);
            } else {
                alert('请上传 .xlsx 格式的Excel文件');
            }
        }
        
        // 处理Excel文件
        function processExcelFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // 验证数据格式
                    if (!jsonData.length) {
                        alert('Excel文件为空');
                        return;
                    }
                    
                    // 检查必要的列
                    const firstRow = jsonData[0];
                    if (!firstRow.hasOwnProperty('岗位') || !firstRow.hasOwnProperty('简历')) {
                        alert('Excel文件格式不正确，需要包含"岗位"和"简历"列');
                        return;
                    }
                    
                    // 处理数据
                    jsonData.forEach(row => {
                        if (row['岗位'] && row['简历']) {
                            const item = {
                                id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                                job: row['岗位'].toString().substring(0, 50) + (row['岗位'].toString().length > 50 ? '...' : ''),
                                fullJob: row['岗位'].toString(),
                                resume: row['简历'].toString().substring(0, 50) + (row['简历'].toString().length > 50 ? '...' : ''),
                                fullResume: row['简历'].toString()
                            };
                            
                            analysisItems.push(item);
                        }
                    });
                    
                    // 更新分析列表
                    renderAnalysisList();
                    
                    // 更新分析计数
                    updateAnalysisCount();
                    
                    // 检查是否可以开始分析
                    checkStartAnalysis();
                    
                    alert(`成功导入 ${analysisItems.length} 条数据`);
                } catch (error) {
                    console.error('处理Excel文件时出错:', error);
                    alert('处理Excel文件时出错，请检查文件格式');
                }
            };
            
            reader.onerror = function() {
                alert('读取文件时出错');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 下载模板
        function downloadTemplate() {
            const data = [
                { '岗位': '前端开发工程师', '简历': '张三，3年前端开发经验，熟悉React、Vue等框架...' },
                { '岗位': '产品经理', '简历': '李四，5年产品经理经验，擅长用户需求分析...' }
            ];
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
            
            // 添加列宽
            ws['!cols'] = [
                { wch: 30 }, // 岗位列宽
                { wch: 50 }, // 简历列宽
                { wch: 10 }, // 是否匹配列宽
                { wch: 10 }, // 匹配分数列宽
                { wch: 50 }  // 分析原因列宽
            ];
            
            // 生成Excel文件并下载
            XLSX.writeFile(wb, '人岗匹配分析模板.xlsx');
        }
        
        // 渲染分析列表
        function renderAnalysisList() {
            if (analysisItems.length === 0) {
                analysisList.innerHTML = `
                    <tr class="text-gray-500 text-center">
                        <td colspan="4" class="px-3 py-4">暂无数据，请添加或上传</td>
                    </tr>
                `;
                return;
            }
            
            analysisList.innerHTML = analysisItems.map((item, index) => `
                <tr>
                    <td class="px-3 py-2 whitespace-nowrap">${index + 1}</td>
                    <td class="px-3 py-2">
                        <div class="max-w-xs truncate" title="${item.fullJob}">${item.job}</div>
                    </td>
                    <td class="px-3 py-2">
                        <div class="max-w-xs truncate" title="${item.fullResume}">${item.resume}</div>
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap">
                        <button class="text-danger hover:text-danger/80" onclick="removeAnalysisItem('${item.id}')">
                            <i class="fa fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // 移除分析项
        function removeAnalysisItem(id) {
            const index = analysisItems.findIndex(item => item.id === id);
            if (index !== -1) {
                analysisItems.splice(index, 1);
                renderAnalysisList();
                updateAnalysisCount();
                checkStartAnalysis();
            }
        }
        
        // 更新分析计数
        function updateAnalysisCount() {
            analysisCount.textContent = analysisItems.length;
        }
        
        // 检查是否可以开始分析
        function checkStartAnalysis() {
            startAnalysisBtn.disabled = analysisItems.length === 0;
        }
        
        // 开始分析
        function startAnalysis() {
            // 清空之前的结果
            analysisResults.length = 0;
            currentAnalysisIndex = 0;
            
            // 显示进度条
            progressContainer.classList.remove('hidden');
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            progressStatus.textContent = '准备开始分析...';
            
            // 隐藏开始按钮
            startAnalysisBtn.classList.add('hidden');
            
            // 开始分析循环
            setTimeout(processNextAnalysis, 1000);
        }
        
        // 处理下一个分析项
        function processNextAnalysis() {
            if (currentAnalysisIndex >= analysisItems.length) {
                // 分析完成
                completeAnalysis();
                return;
            }
            
            // 获取当前分析项
            const item = analysisItems[currentAnalysisIndex];
            
            // 更新进度
            const progress = Math.round((currentAnalysisIndex / analysisItems.length) * 100);
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${progress}%`;
            progressStatus.textContent = `正在分析第 ${currentAnalysisIndex + 1} 项...`;
            
            // 模拟分析过程
            simulateAnalysis(item).then(result => {
                // 添加到结果列表
                analysisResults.push(result);
                
                // 处理下一项
                currentAnalysisIndex++;
                setTimeout(processNextAnalysis, analysisSpeed);
            });
        }
        
        // 模拟分析过程
        function simulateAnalysis(item) {
            return new Promise(resolve => {
                // 生成随机匹配分数
                const matchScore = Math.floor(Math.random() * 41) + 60; // 60-100之间的随机数
                const isMatch = matchScore >= matchThreshold;
                
                // 生成分析原因
                let analysisReasons = '';
                
                // 技能匹配度
                const skillMatch = Math.floor(Math.random() * 31) + 70; // 70-100之间的随机数
                analysisReasons += `技能匹配度：${skillMatch}分。`;
                
                if (skillMatch >= 90) {
                    analysisReasons += `候选人具备岗位要求的所有核心技能，且有丰富的实践经验。`;
                } else if (skillMatch >= 80) {
                    analysisReasons += `候选人具备岗位要求的大部分核心技能，仅有少数技能需要进一步提升。`;
                } else {
                    analysisReasons += `候选人具备岗位要求的基本技能，但在某些关键技能上经验不足。`;
                }
                
                // 经验匹配度
                const experienceMatch = Math.floor(Math.random() * 31) + 70; // 70-100之间的随机数
                analysisReasons += `\\n经验匹配度：${experienceMatch}分。`;
                
                if (experienceMatch >= 90) {
                    analysisReasons += `候选人的工作经验与岗位要求高度匹配，有相关行业或类似岗位的成功案例。`;
                } else if (experienceMatch >= 80) {
                    analysisReasons += `候选人的工作经验与岗位要求较为匹配，有一定的相关经验。`;
                } else {
                    analysisReasons += `候选人的工作经验与岗位要求基本匹配，但在某些方面经验不足。`;
                }
                
                // 教育背景匹配度
                const educationMatch = Math.floor(Math.random() * 31) + 70; // 70-100之间的随机数
                analysisReasons += `\\n教育背景匹配度：${educationMatch}分。`;
                
                if (educationMatch >= 90) {
                    analysisReasons += `候选人的教育背景完全符合岗位要求，专业对口且学历达标。`;
                } else if (educationMatch >= 80) {
                    analysisReasons += `候选人的教育背景基本符合岗位要求，专业相关或学历达标。`;
                } else {
                    analysisReasons += `候选人的教育背景与岗位要求有一定差距，但其他方面表现优秀。`;
                }
                
                // 综合分析
                analysisReasons += `\\n\\n综合分析：`;
                if (isMatch) {
                    analysisReasons += `候选人整体素质与岗位要求匹配度高，建议进一步面试评估。`;
                } else {
                    analysisReasons += `候选人与岗位要求有一定差距，建议考虑其他更合适的候选人或调整岗位要求。`;
                }
                
                // 改进建议
                analysisReasons += `\\n\\n改进建议：`;
                if (skillMatch < 85) {
                    analysisReasons += `1. 加强相关技能培训，特别是在${getRandomSkill()}方面；`;
                }
                if (experienceMatch < 85) {
                    analysisReasons += `\\n2. 积累更多${getRandomExperience()}经验；`;
                }
                if (educationMatch < 85) {
                    analysisReasons += `\\n3. 考虑通过继续教育提升${getRandomEducation()}方面的知识。`;
                }
                if (skillMatch >= 85 && experienceMatch >= 85 && educationMatch >= 85) {
                    analysisReasons += `1. 保持现有优势，继续提升专业能力；\\n2. 关注行业最新发展趋势，持续学习。`;
                }
                
                // 创建结果对象
                const result = {
                    id: item.id,
                    job: item.fullJob,
                    resume: item.fullResume,
                    matchScore: matchScore,
                    isMatch: isMatch,
                    skillMatch: skillMatch,
                    experienceMatch: experienceMatch,
                    educationMatch: educationMatch,
                    analysisReasons: analysisReasons,
                    timestamp: new Date()
                };
                
                // 模拟异步操作
                setTimeout(() => resolve(result), analysisSpeed);
            });
        }
        
        // 获取随机技能
        function getRandomSkill() {
            const skills = ['编程技术', '项目管理', '数据分析', '沟通协作', '问题解决', '创新思维'];
            return skills[Math.floor(Math.random() * skills.length)];
        }
        
        // 获取随机经验
        function getRandomExperience() {
            const experiences = ['团队管理', '项目交付', '客户沟通', '风险控制', '资源协调', '流程优化'];
            return experiences[Math.floor(Math.random() * experiences.length)];
        }
        
        // 获取随机教育
        function getRandomEducation() {
            const educations = ['专业理论', '行业知识', '管理技能', '技术前沿', '领导力', '专业认证'];
            return educations[Math.floor(Math.random() * educations.length)];
        }
        
        // 完成分析
        function completeAnalysis() {
            // 更新进度为100%
            progressBar.style.width = '100%';
            progressText.textContent = '100%';
            progressStatus.textContent = '分析完成！';
            
            // 显示结果区域
            setTimeout(() => {
                // 隐藏进度条
                progressContainer.classList.add('hidden');
                
                // 显示开始按钮
                startAnalysisBtn.classList.remove('hidden');
                
                // 显示结果区域
                resultsSection.classList.remove('hidden');
                
                // 更新统计数据
                updateStatistics();
                
                // 渲染结果表格
                renderResultsTable();
                
                // 创建匹配分数分布图表
                createMatchDistributionChart();
                
                // 切换到结果标签页（移动端）
                if (window.innerWidth < 768) {
                    switchTab('result');
                }
            }, 1000);
        }
        
        // 更新统计数据
        function updateStatistics() {
            totalAnalysis.textContent = analysisResults.length;
            
            const matches = analysisResults.filter(result => result.isMatch).length;
            matchCount.textContent = matches;
            
            const totalScore = analysisResults.reduce((sum, result) => sum + result.matchScore, 0);
            const averageScore = analysisResults.length > 0 ? Math.round(totalScore / analysisResults.length) : 0;
            avgMatchScore.textContent = `${averageScore}%`;
        }
        
        // 渲染结果表格
        function renderResultsTable() {
            resultsTableBody.innerHTML = analysisResults.map((result, index) => `
                <tr>
                    <td class="px-3 py-2 whitespace-nowrap">${index + 1}</td>
                    <td class="px-3 py-2">
                        <div class="max-w-xs truncate" title="${result.job}">${result.job.substring(0, 50) + (result.job.length > 50 ? '...' : '')}</div>
                    </td>
                    <td class="px-3 py-2">
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2.5 mr-2">
                                <div class="bg-${result.isMatch ? 'success' : 'warning'} h-2.5 rounded-full" style="width: ${result.matchScore}%"></div>
                            </div>
                            <span>${result.matchScore}</span>
                        </div>
                    </td>
                    <td class="px-3 py-2">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${result.isMatch ? 'bg-success/10 text-success' : 'bg-warning/10 text-warning'}">
                            ${result.isMatch ? '匹配' : '不匹配'}
                        </span>
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap">
                        <button class="text-primary hover:text-primary/80" onclick="showDetailModal('${result.id}')">
                            <i class="fa fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // 显示详情模态框
        function showDetailModal(id) {
            const result = analysisResults.find(result => result.id === id);
            if (!result) return;
            
            detailModalTitle.textContent = `详细分析报告 - ${result.job.substring(0, 30) + (result.job.length > 30 ? '...' : '')}`;
            
            detailModalContent.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-neutral-light rounded-lg p-4">
                        <h4 class="font-medium mb-2">总体匹配情况</h4>
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 rounded-full h-4 mr-3">
                                <div class="bg-${result.isMatch ? 'success' : 'warning'} h-4 rounded-full" style="width: ${result.matchScore}%"></div>
                            </div>
                            <span class="text-lg font-bold">${result.matchScore}%</span>
                        </div>
                        <div class="mt-2 text-center">
                            <span class="px-3 py-1 rounded-full text-sm font-medium ${result.isMatch ? 'bg-success/10 text-success' : 'bg-warning/10 text-warning'}">
                                ${result.isMatch ? '匹配' : '不匹配'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-neutral-light rounded-lg p-4">
                            <h4 class="font-medium mb-2 text-center">技能匹配度</h4>
                            <div class="flex items-center justify-center">
                                <div class="w-full bg-gray-200 rounded-full h-3 mr-2">
                                    <div class="bg-primary h-3 rounded-full" style="width: ${result.skillMatch}%"></div>
                                </div>
                                <span class="font-bold">${result.skillMatch}%</span>
                            </div>
                        </div>
                        <div class="bg-neutral-light rounded-lg p-4">
                            <h4 class="font-medium mb-2 text-center">经验匹配度</h4>
                            <div class="flex items-center justify-center">
                                <div class="w-full bg-gray-200 rounded-full h-3 mr-2">
                                    <div class="bg-primary h-3 rounded-full" style="width: ${result.experienceMatch}%"></div>
                                </div>
                                <span class="font-bold">${result.experienceMatch}%</span>
                            </div>
                        </div>
                        <div class="bg-neutral-light rounded-lg p-4">
                            <h4 class="font-medium mb-2 text-center">教育背景匹配度</h4>
                            <div class="flex items-center justify-center">
                                <div class="w-full bg-gray-200 rounded-full h-3 mr-2">
                                    <div class="bg-primary h-3 rounded-full" style="width: ${result.educationMatch}%"></div>
                                </div>
                                <span class="font-bold">${result.educationMatch}%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-2">岗位信息</h4>
                        <div class="bg-neutral-light rounded-lg p-4">
                            <p class="whitespace-pre-wrap">${result.job}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-2">简历信息</h4>
                        <div class="bg-neutral-light rounded-lg p-4">
                            <p class="whitespace-pre-wrap">${result.resume}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-2">分析原因</h4>
                        <div class="bg-neutral-light rounded-lg p-4">
                            <p class="whitespace-pre-line">${result.analysisReasons}</p>
                        </div>
                    </div>
                </div>
            `;
            
            detailModal.classList.remove('hidden');
        }
        
        // 创建匹配分数分布图表
        function createMatchDistributionChart() {
            // 销毁之前的图表
            if (matchDistributionChart) {
                matchDistributionChart.destroy();
            }
            
            // 准备数据
            const scoreRanges = {
                '60-69': 0,
                '70-79': 0,
                '80-89': 0,
                '90-100': 0
            };
            
            analysisResults.forEach(result => {
                const score = result.matchScore;
                if (score >= 60 && score < 70) {
                    scoreRanges['60-69']++;
                } else if (score >= 70 && score < 80) {
                    scoreRanges['70-79']++;
                } else if (score >= 80 && score < 90) {
                    scoreRanges['80-89']++;
                } else if (score >= 90) {
                    scoreRanges['90-100']++;
                }
            });
            
            const ctx = document.getElementById('matchDistributionChart').getContext('2d');
            matchDistributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(scoreRanges),
                    datasets: [{
                        label: '人数',
                        data: Object.values(scoreRanges),
                        backgroundColor: [
                            'rgba(245, 158, 11, 0.7)',
                            'rgba(16, 185, 129, 0.7)',
                            'rgba(59, 130, 246, 0.7)',
                            'rgba(79, 70, 229, 0.7)'
                        ],
                        borderColor: [
                            'rgb(245, 158, 11)',
                            'rgb(16, 185, 129)',
                            'rgb(59, 130, 246)',
                            'rgb(79, 70, 229)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw || 0;
                                    const total = analysisResults.length;
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 导出结果
        function exportResults() {
            if (analysisResults.length === 0) {
                alert('暂无结果可导出');
                return;
            }
            
            // 准备导出数据
            const exportData = analysisResults.map(result => ({
                '岗位': result.job,
                '简历': result.resume,
                '是否匹配': result.isMatch ? '是' : '否',
                '匹配分数': result.matchScore,
                '技能匹配度': result.skillMatch,
                '经验匹配度': result.experienceMatch,
                '教育背景匹配度': result.educationMatch,
                '分析原因': result.analysisReasons
            }));
            
            // 创建工作表
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // 添加列宽
            ws['!cols'] = [
                { wch: 30 }, // 岗位列宽
                { wch: 50 }, // 简历列宽
                { wch: 10 }, // 是否匹配列宽
                { wch: 10 }, // 匹配分数列宽
                { wch: 12 }, // 技能匹配度列宽
                { wch: 12 }, // 经验匹配度列宽
                { wch: 15 }, // 教育背景匹配度列宽
                { wch: 50 }  // 分析原因列宽
            ];
            
            // 创建工作簿
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '匹配结果');
            
            // 生成Excel文件并下载
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            XLSX.writeFile(wb, `人岗匹配分析结果_${timestamp}.xlsx`);
        }
        
        // 移动端标签页切换
        function switchTab(tab) {
            // 重置所有标签页样式
            inputTab.classList.remove('text-primary', 'border-b-2', 'border-primary');
            configTab.classList.remove('text-primary', 'border-b-2', 'border-primary');
            resultTab.classList.remove('text-primary', 'border-b-2', 'border-primary');
            
            inputTab.classList.add('text-gray-500');
            configTab.classList.add('text-gray-500');
            resultTab.classList.add('text-gray-500');
            
            // 根据选择的标签页显示对应内容
            switch (tab) {
                case 'input':
                    inputTab.classList.remove('text-gray-500');
                    inputTab.classList.add('text-primary', 'border-b-2', 'border-primary');
                    inputPanel.classList.remove('hidden');
                    configPanel.classList.add('hidden');
                    break;
                    
                case 'config':
                    configTab.classList.remove('text-gray-500');
                    configTab.classList.add('text-primary', 'border-b-2', 'border-primary');
                    inputPanel.classList.add('hidden');
                    configPanel.classList.remove('hidden');
                    break;
                    
                case 'result':
                    resultTab.classList.remove('text-gray-500');
                    resultTab.classList.add('text-primary', 'border-b-2', 'border-primary');
                    inputPanel.classList.add('hidden');
                    configPanel.classList.remove('hidden');
                    break;
            }
        }
    </script>
</body>
</html>